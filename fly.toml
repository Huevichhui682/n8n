# Конфигурация для n8n на fly.io
app = "n8n-bjmkpqrt"
primary_region = "fra"

[build]
  dockerfile = "Dockerfile"

# HTTP сервис
[http_service]
  internal_port = 5678
  force_https = true
  auto_stop_machines = true
  auto_start_machines = true
  min_machines_running = 1
  processes = ["app"]
  
  # Проверка здоровья (упрощенная)
  [[http_service.checks]]
    interval = "60s"
    timeout = "30s"
    grace_period = "10m"
    method = "get"
    path = "/healthz"

# Процесс - используем CMD из Dockerfile
[processes]
app = "npm start -- --host=0.0.0.0 --port=5678"

# Ресурсы
[vm]
  memory = "2gb"
  cpu_kind = "shared"
  cpus = 1

# Переменные окружения
[env]
  # ОБЯЗАТЕЛЬНО: замените на свой ключ!
  N8N_ENCRYPTION_KEY = "123456789012345678901234"
  
  # Базовые настройки
  N8N_HOST = "0.0.0.0"
  N8N_PORT = "5678"
  N8N_PROTOCOL = "https"
  WEBHOOK_URL = "https://n8n-bjmkpqrt.fly.dev/"
  
  # Оптимизация
  DB_TYPE = "sqlite"
  N8N_METRICS = "false"
  N8N_DIAGNOSTICS_ENABLED = "false"
  EXECUTIONS_DATA_PRUNE = "false"
  GENERIC_TIMEZONE = "Europe/Berlin"

# Хранилище для данных
[[mounts]]
  destination = "/home/node/.n8n"
  source = "n8n_data"
